<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>Document</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ubuntu&display=swap');

        ::-webkit-scrollbar {
            width: 2vw;
            background-color: transparent;
        }
        ::-webkit-scrollbar-track {
            width: 2vw;
            background-color: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #09f;
            border-radius: 2vw;
        }

        :root {
            --background: #fff;
            --now-b: #09f;
            --text: #000;

        }

        .darkmode {
            background-color: #000;
            color: #fff;
        }

        html {
            font-family: 'Ubuntu', sans-serif;
            background-color: var(--background);
            user-select: none;
            color: var(--text);
        }

        #welcome {
            font-size: 10vh;
        }

        .minibox {
            width: 20vh;
            height: 28vh;
            background-color: var(--now-b);
            border-radius: 1vh;
            margin-left: 1vw;
            margin-right: 1vw;
            margin-top: 1vh;
            margin-bottom: 1vh;
            display: inline-block;
            border: 2px solid #ddd;
        }

        .mediumbox {
            width: 42vh;
            height: 20vh;
            background-color: var(--now-b);
            border-radius: 4px;
            margin-left: 1vw;
            margin-right: 1vw;
            margin-top: 1vh;
            margin-bottom: 1vh;
            display: inline-block;
            color: #fff;
        }

        #row1 {
            overflow-x: auto;

            white-space: nowrap;
        }

        #row2 {
            overflow-x: auto;

            white-space: nowrap;
        }

        #row3 {
            overflow-x: auto;
            display: none;
            white-space: nowrap;
            border-top: 1vh solid var(--now-b);
        }

        #row4 {
            overflow-x: auto;

            white-space: nowrap;
        }

        .minibox .content {
            background-color: var(--background);
            position: static;
            bottom: 0px;
            left: 0px;
            width: 100%;
            border-radius: 1vh;
            font-size: 6vh;
            text-align: center;
        }

        .minibox .time {
            background-color: var(--background);
            margin: 0;
            text-align: center;
            width: 50%;
            position: relative;
            left: 25%;
        }

        .icon {
            text-align: center;
            width: 17vh;
        }

        .mediumbox #icon {
            align-self: center;
            height: 20vh;
            display: inline-block;
            margin-left: 0.01vw;
            filter: invert(1);
        }

        svg {
            filter: invert(0.5) sepia(1) saturate(5) hue-rotate(175deg)
        }

        .mediumbox #temp {
            align-self: center;
            font-size: 9vh;
            margin: 1vh;
            position: relative;
            bottom: 12vh;
            display: inline;
            color: #fff;
        }

        .mediumbox #time {
            align-self: center;
            display: inline-block;
            position: relative;
            left: -7vh;
        }

        #lang {
            position: absolue;
            right: 0px;
        }

        #windicon {
            height: 7vh;
            filter: invert(1)
        }

        #wind {
            display: inline-block;
            position: relative;
            top: -10vh;
        }

        .minibox .icon {
            filter: invert(1);
        }
        input[type=search] {
            width: 70vw;
            color: #fff;
            height: 5vh;
            background-color: var(--now-b);
            border: none !important;
            border-radius: 2vh 0vh 0vh 2vh;
            font-family: 'Ubuntu', sans-serif;
        }
        button {
            width: 20vw;
            height: 5vh;
            border: none !important;
            background-color: #0ef;
            font-family: 'Ubuntu', sans-serif;
            border-radius: 0vh 2vh 2vh 0vh;
        }
        ::placeholder {
            color: #fff;
        }
    </style>
</head>

<body onload="load();">
    <script>
        function dark() {
            document.documentElement.style.setProperty('--background', '#000');
            document.documentElement.style.setProperty('--now-b', '#048')
            document.documentElement.style.setProperty('--text', '#fff')
        }
        function divdata(index, data) {
            var div = document.getElementById('row3')
            div.innerHTML = data.hourly[index].pressure
            div.style.display = 'block'
        }
        function city(){
            var city = document.getElementById('search').value
            fetch('http://api.openweathermap.org/geo/1.0/direct?q='+city+'&limit=1&appid=911062246487cff1d7ff93826a7e4078').then(data => data.json()).then(data => {
                console.log(data)
                var call = {
                    "coords": {
                        "latitude": data[0].lat,
                        "longitude": data[0].lon
                    }
                }
                pos(call)
            })
        }
        function lang() {
            fetch('lang.json').then(data => data.json()).then(data => {
                console.log(data)
                var savedLang = localStorage.getItem('lang');
                if (savedLang !== 'pl' || savedLang !== 'en') {
                    localStorage.setItem('lang', 'en');
                }
                document.getElementById('welcome').innerHTML = data[savedLang].title
            })
        }
        function setLang() {
            if (localStorage.getItem('lang') == 'pl') {
                localStorage.setItem('lang', 'en');
                lang()
            }
            if (localStorage.getItem('lang') == 'en') {
                localStorage.setItem('lang', 'pl');
                lang()
            }
        }
        function load() {
            document.getElementById('row2').innerHTML = '<img src="loading.svg">'+'Lokalizowanie...'
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos);
            }
            lang()
            
        }
        function toC(temp) {
            return Math.round((temp - 273.15)) + 'º';
        }
        /*function rain(data){
            var raindiv = document.getElementById('row3');
            for(var i=0;i<Object.keys(data.minutely).length;i++){
                console.log(data.minutely[i].precipitation)
                if(data.minutly[i].precipitation < 7.5){
                    raindiv.innerText('Silny deszcz')
                }
                if(data.minutely[i].precipitation > 2.5 && data.minutly[i].precipitation < 7.5){
                    raindiv.innerText('Umiarkowany deszcz')
                }
                if(data.minutely[i].precipitation > 0 && data.minutly[i].precipitation < 2.5){
                    raindiv.innerText('Lekki deszcz')
                }
                if(data.minutely[i].precipitation = 0){
                    raindiv.innerText('Brak opadów')
                }
            }
        }*/
        function pos(pos) {
            document.getElementById('row2').innerHTML = ''
            document.getElementById('row5').innerHTML = '<iframe src="https://embed.windy.com/embed2.html?lat='+pos.coords.latitude+'&amp;lon='+pos.coords.longitude+'&zoom=10" frameborder="0" width="100%" height="500vh"></iframe>'
            fetch('https://api.openweathermap.org/data/2.5/onecall?lat=' + pos.coords.latitude + '&lon=' + pos.coords.longitude + '&appid=' + '911062246487cff1d7ff93826a7e4078')
                .then((response) => { return response.json(); })
                .then((data) => {
                    document.getElementById('icon').setAttribute('src', icons(data.current.weather[0].icon))
                    console.log(data)
                    console.log(data.daily[1])
                    var now = new Date(data.current.dt * 1000);
                    document.getElementById('temp').innerHTML = Math.round((data.current.temp - 273.15)) + 'º';
                    document.getElementById('time').innerHTML = now.toLocaleTimeString().substring(0, now.toLocaleTimeString().length - 3)
                    document.getElementById('windicon').style.transform = 'rotate(' + data.current.wind_deg + 'deg)';
                    document.getElementById('windspeed').innerHTML = (Math.round(data.current.wind_speed * 10) / 10) + 'm/s'
                    //rain(data)
                    for (i = 1; i < Object.keys(data.hourly).length - 1; i++) {
                        var d = new Date(data.hourly[i].dt * 1000);
                        var hour = document.createElement('DIV')
                        var hrtemp = document.createElement('DIV')
                        var hricon = document.createElement('IMG')
                        var hrhr = document.createElement('DIV')
                        hour.setAttribute('id', 'hr' + i);
                        hour.click = divdata(i, data)
                        hrhr.className = 'time'
                        hrhr.innerHTML = d.toLocaleTimeString().substring(0, d.toLocaleTimeString().length - 3)
                        hour.appendChild(hrhr)
                        hricon.setAttribute('src', icons(data.hourly[i].weather[0].icon))
                        hricon.className = 'icon'
                        hour.appendChild(hricon)
                        hrtemp.innerHTML = toC(data.hourly[i].temp);
                        hrtemp.className = 'content'
                        hour.className = 'minibox'
                        hour.appendChild(hrtemp)
                        document.getElementById('row2').appendChild(hour)
                        
                    }
                    for (n = 0; n < 7; n++) {
                        var d = new Date(data.daily[n].dt * 1000);
                        var day = document.createElement('DIV')
                        var dytemp = document.createElement('DIV')
                        var dyicon = document.createElement('IMG')
                        var dyhr = document.createElement('DIV')
                        console.log(d)
                        var today = new Date();
                        var dd = today.getDate()
                        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
                        var yyyy = today.getFullYear();

                        today = dd + '/' + mm + '/' + yyyy;
                        dyhr.innerHTML = today;
                        dyhr.className = 'time'
                        dyhr.innerHTML = (d.getDate()+1) + '.' + (d.getMonth() + 1)
                        day.appendChild(dyhr)
                        dyicon.setAttribute('src', icons(data.daily[n].weather[0].icon))
                        dyicon.className = 'icon'
                        day.appendChild(dyicon)
                        dytemp.innerHTML = toC(data.daily[n].temp.day) + '|' + toC(data.daily[n].temp.night);
                        dytemp.className = 'content'
                        day.className = 'minibox'
                        day.appendChild(dytemp)
                        document.getElementById('row4').appendChild(day)
                    }
                });
        }
        function icons(icon, code) {
            if (icon == '01d') {
                return 'weather-icons-master/svg/wi-day-sunny.svg';
            }
            if (icon == '02d') {
                return 'weather-icons-master/svg/wi-day-sunny-overcast.svg';
            }
            if (icon == '03d' || icon == '03n') {
                return 'weather-icons-master/svg/wi-cloud.svg';
            }
            if (icon == '04d' || icon == '04n') {
                return 'weather-icons-master/svg/wi-cloudy.svg';
            }
            if (icon == '09d' || icon == '09n') {
                return 'weather-icons-master/svg/wi-rain.svg';
            }
            if (icon == '10d') {
                return 'weather-icons-master/svg/wi-day-rain.svg';
            }
            if (icon == '11d' || icon == '11n') {
                return 'weather-icons-master/svg/wi-thunderstorm.svg';
            }
            if (icon == '13d' || icon == '13n') {
                return 'weather-icons-master/svg/wi-snow.svg';
            }
            if (icon == '50d' || icon == '50n') {
                return 'weather-icons-master/svg/wi-fog.svg';
            }
            if (icon == '01n') {
                return 'weather-icons-master/svg/wi-night-clear.svg';
            }
            if (icon == '02n') {
                return 'weather-icons-master/svg/wi-night-partly-cloudy.svg';
            }
            if (icon == '10n') {
                return 'weather-icons-master/svg/wi-night-rain.svg';
            }
            else {
                return 'weather-icons-master/svg/wi-refresh.svg'
            }
        }
    </script>
    <div id="settings"><img src="lang.svg" onclick="setLang()"></div>
    <span id="welcome"></span><br>
    <input type="search" id="search" placeholder="Wyszukaj miasto, dzielnince"><button onclick="city()">Szukaj</button>
    <h3>Teraz</h3>
    <div id="row1">
        <div class="mediumbox" id="mediumbox1"><img id="icon" src="weather-icons-master\svg\wi-refresh.svg">
            <div id="temp">1</div>
            <div id="wind">
                <div id="windspeed">2.6m/s</div>
                <img id="windicon" src="weather-icons-master/svg/wi-wind-deg.svg">
            </div>
            <div id="time">22:22</div>
        </div>

    </div>
    <h3>Prognoza godzinowa</h3>
    <div id="row2">
    </div>
    <div id="row3">opis</div>
    <h3>Prognoza 7 dniowa</h3>
    <div id="row4"></div>
    <h4>Radar</h4>
    <div id="row5"><iframe src="https://embed.windy.com/embed2.html?lat=50&lon=18" frameborder="0" width="100%" height="500vh" ></iframe></div>
    <footer>Thanks for icons from erikflowers ❤</footer>
</body>

</html>